syntax = "proto3";

import "google/protobuf/timestamp.proto";

package Radar;

message EquitySource { string equity = 1; }
message InterestOnOwnCapital { string equity = 1; }

message Event {
  enum PositionType {
    SWING_TRADE = 0;
    DAY_TRADE = 1;
  }
  enum TransactionType {
    OTHER = 0;
    STOCK = 1;
    OPTION = 2;
    REIT = 3;
    SUBSCRIPTION_RIGHT = 4;
  }
  message CashFlow {
    enum Type {
      OTHER = 0;
      DIVIDEND = 1;
      INTEREST_ON_OWN_CAPITAL = 2;
    }
    Type type = 1;
    double value = 2;
    string source = 3;
  }
  message Portfolio {
    message Position {
      string id = 1;
      int32 shares = 2;
      double value = 3;
      double avg_price = 4;
    }
    message Provision {
      double value = 1;
      string source = 2;
    }
    repeated Position position = 1;
    repeated Provision provision = 2;
  }
  message PositionMonthTax {
    PositionType position_type = 1;
    TransactionType transaction_type = 2;
    double value = 3;
  }
  message StockExemptMonthTax { 
    double value = 1;
  }
  message AccumulatedTaxCredit {
    double swing_trade = 1;
    double day_trade = 2;
    double reit = 3;
  }
  google.protobuf.Timestamp date = 1;
  oneof type {
    CashFlow cash_flow = 20;
    Portfolio portfolio = 21;
    PositionMonthTax position_month_tax = 22;
    StockExemptMonthTax stock_exempt_month_tax = 23;
    AccumulatedTaxCredit accumulated_tax_credit = 24;
  }
}

message RunReq {
  enum Event {
    CASH_FLOW = 0;
    EACH_DAY = 1;
  }
  string user_id = 1;
  string portfolio_id = 2;
  repeated Event events = 3;
}

service Portfolios {
  rpc Run(RunReq) returns (stream Event) {}
}
